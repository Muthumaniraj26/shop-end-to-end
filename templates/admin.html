<!doctype html>
<title>Admin</title>
<h2>Admin Dashboard: {{username}}</h2>
<a href="/logout">Logout</a>
<hr>
<h3>Add Worker / Shopkeeper</h3>
<form id="addUserForm">
  Username: <input id="new_username" required><br>
  Password: <input id="new_password" type="password" required><br>
  Role: <select id="new_role">
    <option value="worker">Worker</option>
    <option value="shopkeeper">Shopkeeper</option>
  </select><br>
  <button type="button" onclick="addUser()">Add User</button>
</form>
<div id="addUserResult"></div>

<h3>Change your password</h3>
<form id="changePassForm">
  Old Password: <input id="old_pass" type="password"><br>
  New Password: <input id="new_pass" type="password"><br>
  <button type="button" onclick="changePass()">Change Password</button>
</form>
<div id="changePassResult"></div>

<script>
async function addUser(){
  const username = document.getElementById("new_username").value;
  const password = document.getElementById("new_password").value;
  const role = document.getElementById("new_role").value;
  const r = await fetch("/admin/add_user",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({username,password,role})
  });
  const res = await r.json();
  document.getElementById("addUserResult").innerText = res.message || res.error;
}

async function changePass(){
  const old_password = document.getElementById("old_pass").value;
  const new_password = document.getElementById("new_pass").value;
  const r = await fetch("/user/change_password",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({old_password,new_password})
  });
  const res = await r.json();
  document.getElementById("changePassResult").innerText = res.message || res.error;
}
</script>
